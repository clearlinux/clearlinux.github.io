

<!-- THEME DEBUG -->
<!-- THEME HOOK: 'html' -->
<!-- FILE NAME SUGGESTIONS:
   * html--node--684.html.twig
   * html--node--%.html.twig
   * html--node.html.twig
   x html.html.twig
-->
<!-- BEGIN OUTPUT from 'modules/custom/clearlinux.org/themes/clearlinux_theme/templates/layout/html.html.twig' -->
<!DOCTYPE html>
<html lang="en" dir="ltr" prefix="content: http://purl.org/rss/1.0/modules/content/  dc: http://purl.org/dc/terms/  foaf: http://xmlns.com/foaf/0.1/  og: http://ogp.me/ns#  rdfs: http://www.w3.org/2000/01/rdf-schema#  schema: http://schema.org/  sioc: http://rdfs.org/sioc/ns#  sioct: http://rdfs.org/sioc/types#  skos: http://www.w3.org/2004/02/skos/core#  xsd: http://www.w3.org/2001/XMLSchema# ">
<head>
    <meta charset="utf-8" />
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-61272224-1"></script>
<script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments)};gtag("js", new Date());gtag("config", "UA-61272224-1", {"groups":"default","linker":{"domains":["docs.01.org\/clearlinux"]},"anonymize_ip":true,"allow_ad_personalization_signals":false});</script>
<meta name="description" content="Summary Securing an OS is a difficult thing. Attacks can be old or new, with some being well-understood and others yet undiscovered. The Clear Linux* project recently undertook the task of securing our “swupd” software update tooling against one of the primary means of attack. This document details steps taken to secure the update process, presenting an overview of how a Clear user can utilize this new security, and covers some details on our use of OpenSSL and other tools." />
<meta property="og:site_name" content="Clear Linux* Project" />
<meta property="og:type" content="Blog" />
<meta property="og:url" content="https://clearlinux.org/news-blogs/security-software-update-clear-linux-os" />
<meta property="og:title" content="Security for software update in Clear Linux* OS" />
<meta property="og:description" content="Summary Securing an OS is a difficult thing. Attacks can be old or new, with some being well-understood and others yet undiscovered. The Clear Linux* project recently undertook the task of securing our “swupd” software update tooling against one of the primary means of attack. This document details steps taken to secure the update process, presenting an overview of how a Clear user can utilize this new security, and covers some details on our use of OpenSSL and other tools." />
<meta name="Generator" content="Drupal 9 (https://www.drupal.org)" />
<meta name="MobileOptimized" content="width" />
<meta name="HandheldFriendly" content="true" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>div#sliding-popup, div#sliding-popup .eu-cookie-withdraw-banner, .eu-cookie-withdraw-tab {background: #0779BF} div#sliding-popup.eu-cookie-withdraw-wrapper { background: transparent; } #sliding-popup h1, #sliding-popup h2, #sliding-popup h3, #sliding-popup p, #sliding-popup label, #sliding-popup div, .eu-cookie-compliance-more-button, .eu-cookie-compliance-secondary-button, .eu-cookie-withdraw-tab { color: #ffffff;} .eu-cookie-withdraw-tab { border-color: #ffffff;}</style>
<link rel="icon" href="../modules/custom/clearlinux.org/themes/clearlinux_theme/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="canonical" href="../node/684.html" />
<link rel="shortlink" href="../node/684.html" />
<script src="../sites/default/files/eu_cookie_compliance/eu_cookie_compliance.script.js" defer></script>

    <title>Security for software update in Clear Linux* OS | Clear Linux* Project</title>
    <link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/ajax-progress.module.css" />
<link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/align.module.css" />
<link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/autocomplete-loading.module.css" />
<link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/fieldgroup.module.css" />
<link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/container-inline.module.css" />
<link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/clearfix.module.css" />
<link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/details.module.css" />
<link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/hidden.module.css" />
<link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/item-list.module.css" />
<link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/js.module.css" />
<link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/nowrap.module.css" />
<link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/position-container.module.css" />
<link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/progress.module.css" />
<link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/reset-appearance.module.css" />
<link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/resize.module.css" />
<link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/sticky-header.module.css" />
<link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/system-status-counter.css" />
<link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/system-status-report-counters.css" />
<link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/system-status-report-general-info.css" />
<link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/tabledrag.module.css" />
<link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/tablesort.module.css" />
<link rel="stylesheet" media="all" href="../core/themes/stable/css/system/components/tree-child.module.css" />
<link rel="stylesheet" media="all" href="../modules/contrib/eu_cookie_compliance/css/eu_cookie_compliance.css" />
<link rel="stylesheet" media="all" href="../modules/contrib/extlink/extlink.css" />
<link rel="stylesheet" media="all" href="https://use.fontawesome.com/releases/v6.1.0/css/all.css" />
<link rel="stylesheet" media="all" href="https://use.fontawesome.com/releases/v6.1.0/css/v4-shims.css" />
<link rel="stylesheet" media="all" href="../libraries/codesnippet/lib/highlight/styles/monokai_sublime.css" />
<link rel="stylesheet" media="all" href="../modules/custom/clearlinux.org/themes/clearlinux_theme/css/styles.css" />
<link rel="stylesheet" media="all" href="http://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.2.1/assets/owl.carousel.min.css" integrity="sha256-AWqwvQ3kg5aA5KcXpX25sYKowsX97sTCTbeo33Yfyk0=" crossorigin="anonymous" />

    <script src="../core/assets/vendor/modernizr/modernizr.min.js"></script>
<script src="../core/misc/modernizr-additional-tests.js"></script>

</head>
<body class="alias--news-blogs-security-software-update-clear-linux-os nodetype--blog logged-out">
<div id="skip">
    <a class="visually-hidden focusable skip-link" href="security-software-update-clear-linux-os.html#main-menu">
        Skip to main navigation
    </a>
</div>



<!-- THEME DEBUG -->
<!-- THEME HOOK: 'off_canvas_page_wrapper' -->
<!-- BEGIN OUTPUT from 'core/themes/stable/templates/content/off-canvas-page-wrapper.html.twig' -->
  <div class="dialog-off-canvas-main-canvas" data-off-canvas-main-canvas>
    

<!-- THEME DEBUG -->
<!-- THEME HOOK: 'page' -->
<!-- FILE NAME SUGGESTIONS:
   * page--node--blog.html.twig
   * page--node--684.html.twig
   * page--node--%.html.twig
   * page--node.html.twig
   x page.html.twig
-->
<!-- BEGIN OUTPUT from 'modules/custom/clearlinux.org/themes/clearlinux_theme/templates/layout/page.html.twig' -->
  <!-- ______________________ HEADER _______________________ -->
  
  

<header id="header">
  <div class="container padding-md--left-right">
    <div class="header__menu_mobile">
      <i class="fa fa-bars header__menu_mobile__control" aria-hidden="true"></i>
    </div>

    <div id="header__site_info">
        <div class="header__site_img_wrapper">
          <a href ="../index.html">
                          <img class="header__site_img_object" src="../modules/custom/clearlinux.org/themes/clearlinux_theme/clear_linux_logo.svg" alt="Logo Clear Linux* Project"/>
                        <img class="header__site_txt_object" src="../modules/custom/clearlinux.org/themes/clearlinux_theme/sass/components/layout/header/assets/clear-linux-text.svg" />
          </a>
        </div>
    </div>

          <nav class="header__menu">
        <ul class="header__menu_list">
                         <li class="header__menu_list_item   ">
                <a tabindex='1' href="../about.html">About</a>
              </li>
                         <li class="header__menu_list_item   ">
                <a tabindex='1' href="../developer.html">Developer</a>
              </li>
                         <li class="header__menu_list_item   ">
                <a tabindex='1' href="../software/software.html">Software</a>
              </li>
                   </ul>
      </nav>
    
    <div class="header__search">
      

<div class="header__search_form__wrapper">
  </div>
</div>
    </div>

  </div>
</header>
<!-- /header -->
  <div class="header__menu-submenu green">
    <div class="toolbar__container">
      <div class="container   padding-md--left-right">
        <ul class='Header__main'>
                  </ul>
      </div>
    </div>
  </div>

  

<div class="wrapper banner blog"  >
  <div class="banner__gradient  "></div>
    <div class="container banner__container ">
    <div class="banner__content">
              <h1 class="banner__title">Blogs &amp; News</h1>
      
      
      
          </div>

      </div>
</div>

<!-- Page Header -->
<div class="page_header">
  <div class="page_header__main">
    
    <!-- tabs -->
        
  </div>
</div>
<!-- End Page Header -->

<!-- ______________________ MAIN _______________________ -->
<main  class="page-standard padding-md--top padding-lg--bottom padding-md--left-right container-xl">
    

      

<!-- THEME DEBUG -->
<!-- THEME HOOK: 'region' -->
<!-- FILE NAME SUGGESTIONS:
   x region--content.html.twig
   * region.html.twig
-->
<!-- BEGIN OUTPUT from 'modules/custom/clearlinux.org/themes/clearlinux_theme/templates/layout/region--content.html.twig' -->


<!-- THEME DEBUG -->
<!-- THEME HOOK: 'block' -->
<!-- FILE NAME SUGGESTIONS:
   * block--clearlinux-theme-messages.html.twig
   x block--system-messages-block.html.twig
   * block--system.html.twig
   * block.html.twig
-->
<!-- BEGIN OUTPUT from 'core/themes/stable/templates/block/block--system-messages-block.html.twig' -->
<div data-drupal-messages-fallback class="hidden"></div>

<!-- END OUTPUT from 'core/themes/stable/templates/block/block--system-messages-block.html.twig' -->



<!-- THEME DEBUG -->
<!-- THEME HOOK: 'block' -->
<!-- FILE NAME SUGGESTIONS:
   x block--sharethis.html.twig
   * block--sharethis-block.html.twig
   x block--sharethis.html.twig
   * block.html.twig
-->
<!-- BEGIN OUTPUT from 'modules/custom/clearlinux.org/themes/clearlinux_theme/templates/block/block--sharethis.html.twig' -->
<div id="block-sharethis" data-block-plugin-id="sharethis_block" class="block block-sharethis block-sharethis-block social_share">  
  <div class="sharethis-wrapper">
    <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fclearlinux.org%2Fnews-blogs%2Fwhere-etcfstab-clear-linux&amp%3Bsrc=sdkpreparse" class="st_facebook_custom"></a>
    <a target="_blank" href="https://twitter.com/intent/tweet?text=Clear%20Linux*%20Project&url=https%3A%2F%2Fclearlinux.org%2Fnews-blogs%2Fwhere-etcfstab-clear-linux" class="st_twitter_custom"></a>
    <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fclearlinux.org%2Fnews-blogs%2Fwhere-etcfstab-clear-linux&title=Clear%20Linux*%20Project" class="st_linkedin_custom"></a>
  </div>
</div>
<!-- END OUTPUT from 'modules/custom/clearlinux.org/themes/clearlinux_theme/templates/block/block--sharethis.html.twig' -->



<!-- THEME DEBUG -->
<!-- THEME HOOK: 'block' -->
<!-- FILE NAME SUGGESTIONS:
   x block--clearlinux-theme-content.html.twig
   * block--system-main-block.html.twig
   * block--system.html.twig
   * block.html.twig
-->
<!-- BEGIN OUTPUT from 'modules/custom/clearlinux.org/themes/clearlinux_theme/templates/block/block--clearlinux-theme-content.html.twig' -->
    

<!-- THEME DEBUG -->
<!-- THEME HOOK: 'node' -->
<!-- FILE NAME SUGGESTIONS:
   * node--684--full.html.twig
   * node--684.html.twig
   x node--blog--full.html.twig
   * node--blog.html.twig
   * node--full.html.twig
   * node.html.twig
-->
<!-- BEGIN OUTPUT from 'modules/custom/clearlinux.org/themes/clearlinux_theme/templates/content/node--blog--full.html.twig' -->
<div class="blog_detail">

      <div class="blog_detail__categories">
              <a tabindex='2' href='../blogs_category_5.html' title='Maintenance'>Maintenance</a>
                  </div>
  
      <h1 class="blog_detail__title">

<!-- THEME DEBUG -->
<!-- THEME HOOK: 'field' -->
<!-- FILE NAME SUGGESTIONS:
   * field--node--title--blog.html.twig
   x field--node--title.html.twig
   * field--node--blog.html.twig
   * field--title.html.twig
   * field--string.html.twig
   * field.html.twig
-->
<!-- BEGIN OUTPUT from 'core/themes/stable/templates/field/field--node--title.html.twig' -->
<span>Security for software update in Clear Linux* OS</span>

<!-- END OUTPUT from 'core/themes/stable/templates/field/field--node--title.html.twig' -->

</h1>
  
  
      <p class="blog_detail__date">04 Oct, 2016</p>
  
  
  
  
  

<!-- THEME DEBUG -->
<!-- THEME HOOK: 'links__node' -->
<!-- FILE NAME SUGGESTIONS:
   * links--node.html.twig
   x links.html.twig
-->
<!-- BEGIN OUTPUT from 'themes/contrib/cog/templates/navigation/links.html.twig' -->

<!-- END OUTPUT from 'themes/contrib/cog/templates/navigation/links.html.twig' -->



<!-- THEME DEBUG -->
<!-- THEME HOOK: 'field' -->
<!-- FILE NAME SUGGESTIONS:
   * field--node--body--blog.html.twig
   x field--node--body.html.twig
   * field--node--blog.html.twig
   * field--body.html.twig
   * field--text-with-summary.html.twig
   * field.html.twig
-->
<!-- BEGIN OUTPUT from 'modules/custom/clearlinux.org/themes/clearlinux_theme/templates/field/field--node--body.html.twig' -->


<div class="Text__description">
      <h1><span>Summary</span></h1>

<p><span>Securing an OS is a difficult thing. Attacks can be old or new, with some being well-understood and others yet undiscovered. The Clear Linux* project recently undertook the task of securing our <span>“swupd” </span>software update tooling against one of the primary means of attack. This document details steps taken to secure the update process, presenting an overview of how a Clear user can utilize this new security, and covers some details on our use of OpenSSL and other tools.</span></p>

<h1><span>Signatures and signature verification</span></h1>

<p><span>Signing and signature verification allows the Clear Linux team to create content and meta-data which enables the user to verify that the content came from us.  This is accomplished through public key cryptography, where a key pair, one private and one public, are used to encrypt a hash of the MoM, generating a signature file. This signature then provides two assurances - integrity and non-repudiation.</span></p>

<p>Done correctly, this prevents an attacker from modifying files on your system by hacking the system update process. Securing the update process can prevent a broad class of attacks from succeeding, while also providing the user a means of:</p>

<ol><li><span>Recognizing that their system has been hacked: </span><br /><span>Use "</span><span>$ swupd verify"</span><span>, which relies on a signed/verified manifest of files, to identify modified files.</span></li>
	<li><span>Providing a possible mechanism for recovery:<br />
	"</span><span>$ swupd verify --fix" </span><span>can, for certain attacks, restore corrupted, modified and missing files</span></li>
</ol><p><span>Together these capabilities make it much more difficult for an attacker to land content on a system, and easier to recognize when or if such a hack takes place.</span></p>

<h1> </h1>

<h1><span>Pre-install: How to verify an OS image </span></h1>

<p><span>Verification of downloaded images is a manual process performed by a human via the following steps: </span></p>

<ol><li>
	<p><span>Download the current ClearLinuxRoot.pem certificate; this is provided with the release being downloaded. For example, to verify the 8970 release, obtain the certificate from</span><a href="https://download.clearlinux.org/releases/8970/clear/ClearLinuxRoot.pem"><span> https://download.clearlinux.org/releases/8970/clear/ClearLinuxRoot.pem</span></a><span>.</span></p>
	</li>
	<li>
	<p><span>Download the desired OS image, as well as the [image]-SHA512SUMS.sig file.</span></p>
	</li>
	<li>
	<p><span>Validate the release’s ClearLinuxRoot.pem certificate:</span></p>
	</li>
</ol><ul><li>
	<ul><li><span>Validate the certificate by comparing the downloaded certificate’s sha256sum hash with what is published here:</span><br /><br /><span>You should see this (accurate as of 2016-06-16 00:00 UTC):</span></li>
	</ul></li>
</ul><table><tbody><tr><td>
			<blockquote>
			<p><span>$ sha256sum ClearLinuxRoot.pem</span></p>

			<p><span>4b0ca67300727477913c331ff124928a98bcf2fb12c011a855f17cd73137a890  ClearLinuxRoot.pem</span></p>
			</blockquote>
			</td>
		</tr></tbody></table><ul><li>
	<ul><li><span>Now verify that the signature file is valid, which also proves the OS image tarball is as trusted as the ClearLinuxRoot certificate. To do this, create the SHA512SUMS file of the tarball. This is the content which is actually signed by the release team.</span></li>
	</ul></li>
</ul><table><tbody><tr><td>
			<blockquote>
			<p><span>$ sha512sum [image].tar.xz &gt; sha512sum.out</span></p>
			</blockquote>
			</td>
		</tr></tbody></table><ul><li>
	<ul><li><span>Finally, we can use openssl to validate the signed SHA512SUMS.sig was signed by the ClearLinuxRoot certificate:</span></li>
	</ul></li>
</ul><table><tbody><tr><td>
			<blockquote>
			<p><span>$ openssl smime -verify -in [image]-SHA512SUMS.sig -inform der -content sha512sum.out -CAfile ClearLinuxRoot.pem -out /dev/null</span></p>

			<p><span>Verification successful</span></p>
			</blockquote>
			</td>
		</tr></tbody></table><p><span> </span><span>After running this, you should see: “Verification successful” as shown. If you do not see this, you cannot be certain the OS you downloaded can be trusted.</span></p>

<h1> </h1>

<h1><span>How SWUPD verifies content before install or update</span></h1>

<p><strong><span>Figure 1</span></strong><span> provides an overview of the update delivery and signing and verification process. The Build and Release process builds the update content, signs the Manifest of Manifests (MoM), and pushes that content to an external web server.  Collectively, the MoM, MoM signature, and known-good certificate (obtained with the initial OS image) are used to ensure files being installed or updated are the artifacts actually generated and published by the Clear Linux OS build and release process.</span></p>

<p><strong> </strong></p>

<h2><img alt="Overview of the update delivery and signing and verification process" data-entity-type="" data-entity-uuid="" src="https://stg.clearlinux.org/sites/default/files/signing1.png" /></h2>

<h4><span> <strong>Figure 1</strong></span></h4>

<p><strong><span> </span></strong></p>

<h2><span>Creating a signature file for a clear update: Manifests</span></h2>

<p><span>As noted above, the build and release process is responsible for signing the manifest. This statement embodies a lot of hidden nuance, so we will delve into that a bit shortly.  But first, some comments on manifests.</span></p>

<p><span>There are several different types of manifests for Clean Linux, which are a listing of filesystem artifacts and meta-data related to those artifacts.  Every bundle in Clear Linux has a manifest describing its contents.  The Manifest of Manifests (MoM) is a listing of all the valid bundle manifests and checksums of each Manifest.  Manifests are valid for transitions from a specific release to a specific release.</span></p>

<p><span>To take one example, here is an excerpt of an actual Clear Linux manifest:</span></p>

<table><tbody><tr><td>
			<blockquote>
			<p><span>MANIFEST</span><span>    </span><span>5</span><br /><span>version:</span><span>    </span><span>9840</span><br /><span>previous:</span><span>    </span><span>9800</span><br /><span>filecount:</span><span>    </span><span>15679</span><br /><span>timestamp:</span><span>    </span><span>1470700089</span><br /><span>contentsize:</span><span>    </span><span>225381381</span><br /><span>includes:</span><span>    </span><span>os-core</span></p>

			<p><span>L...</span><span>    </span><span>c8ecd198cd3e49343fb07cfd09b6f3e4de878e39f54681ad8330b5ab55f28e1d</span><span>    </span><span>9740</span><span>    </span><span>/usr/bin/cc</span><br /><span>F...</span><span>    </span><span>1176e336f546949485f0bdccf82fd78da99f87f4fdb335b9bfab5c103afe53f7</span><span>    </span><span>9740</span><span>    </span><span>/usr/bin/callgraph</span><br /><span>L...</span><span>    </span><span>4e34c5837a64d98dddb6a237a456026a75cfce2d81134388858de06f3714c4b5</span><span>    </span><span>9740</span><span>    </span><span>/usr/bin/c++</span><br /><span>F...</span><span>    </span><span>92056e06ce2c2b791ef5f1961659c2dba2af9d3cd09e3faaf99655b8066c9052</span><span>    </span><span>9740</span><span>    </span><span>/usr/bin/benchcmp</span><br /><span>F...</span><span>    </span><span>f056759a4fc3d09e0774b715fd946e47b01f01c7296c0dc0bce0254bddc314e4</span><span>    </span><span>9770</span><span>    </span><span>/usr/share/man/man3/lib.3</span></p>

			<p><span>...</span></p>
			</blockquote>
			</td>
		</tr></tbody></table><p><span>As we can see, the header describes the manifest format, the contents, "from" and "to" release versions and a few other fields we won't go into here.</span></p>

<p><span>Following the header is a list of the bundle contents and associated checksums:</span></p>

<blockquote>
<p><span>L...</span><span>    </span><span>c8ecd198cd3e49343fb07cfd09b6f3e4de878e39f54681ad8330b5ab55f28e1d</span><span>    </span><span>9740</span><span>    </span><span>/usr/bin/cc</span></p>
</blockquote>

<p><span>The leading four bytes describe what the entry is (file, directory, symLink or subManifest).</span></p>

<p><span>The 64-character hash is a checksum of file contents and file meta-data such as file permissions.</span></p>

<p><span>Taken collectively, the top level manifest provides a listing of the sub-manifests (one per bundle), with checksums for each. Those in turn provide checksums for the individual files, directories, and sym-links.</span></p>

<p><span>Thus that top-level manifest enables us to verify the contents of each and every file installed by Clear Linux OS onto a system, simply by walking through it and the installed sub-manifests, and by calculating hashes for installed files and comparing them to those listed.  If an attacker tries to change a bundle manifest and/or the associated MoM entry for that manifest, calculating the hash of hashes will yield a result different from the signed hash distributed by the Clear Linux* project, and will be detected.</span></p>

<p><span>So, how do we sign the manifest, thus tying the manifest contents to an unalterable identity rooted in the Clear Linux Certificate?</span></p>

<p><span>First, we want to sign the minimal amount of bits possible, since large files take large amounts of time to sign. So we generate a checksum for the full manifest and sign </span><span>that</span><span>.</span></p>

<table><tbody><tr><td>
			<blockquote>
			<p><span>$ sha256sum Manifest.MoM &gt; manifest.sum</span></p>
			</blockquote>
			</td>
		</tr></tbody></table><p><span>Within Intel, and for official Clear Linux releases, we use an enterprise signing service.</span></p>

<p><span>For Clear Linux custom OS mixes, you would use OpenSSL from the command line to sign a custom Manifest.sum, using a command such as:</span></p>

<table><tbody><tr><td>
			<blockquote>
			<p><span>$ openssl dgst -sha256 -sign “your private key” -out manifest.sig manifest.sum</span></p>
			</blockquote>
			</td>
		</tr></tbody></table><p><span>Either way, you now have a manifest.sum, which can be used to verify the Manifest.MoM is unaltered.</span></p>

<h2><span>The SWUPD implementation </span></h2>

<p><span>Part 2 of this article, written by Tudor Marcu, will go into greater depth on our usage of the OpenSSL API.  But first, we will offer an overview of how swupd implements signature checking and manifest content verification. The following steps include some sample equivalent commands which can be done on the command line, but ultimately the implementation is done in C using the OpenSSLAPI.  See the “swupd-client” source on GitHub for full details.</span></p>

<ol><li>
	<p><span>A trusted certificate is distributed with all Clear Linux OS releases in /usr/share/clear/update-ca/ClearLinuxRoot.pem.</span></p>
	</li>
	<li>
	<p><span>swupd</span><span> downloads the top-level manifest (MoM), as well as the signed MoM.sig for the currently-installed image, and for the target release in the case of an update.</span></p>
	</li>
	<li>
	<p><span>swupd</span><span> generates a sha256sum of the MoM.</span></p>
	</li>
	<li>
	<p><span>swupd</span><span> uses the MoM.sig downloaded in step 1, as well as the sha256sum; and, using the OpensSSL API, it makes a call equivalent to the following verification command:</span></p>
	</li>
</ol><table><tbody><tr><td>
			<blockquote>
			<p><span>$ openssl smime -verify -in sha256sums.sig -inform der -content sha512sum.out -CAfile ClearLinuxRoot.pem</span></p>
			</blockquote>
			</td>
		</tr></tbody></table><p><span>5. Note that the actual API call is to PKCS7_verify()).</span></p>

<p><span>6. With a successful verification, we can proceed to trust this MoM and its contents.</span></p>

<ul><li>
	<ul><li><strong><span>Success: </span></strong><span>When a successful signature verification occurs, you should see the following message as part of the </span><span>swupd</span><span> output:</span></li>
	</ul></li>
</ul><table><tbody><tr><td>
			<blockquote>
			<p><span>Signature check succeeded</span></p>
			</blockquote>
			</td>
		</tr></tbody></table><ul><li>
	<ul><li><span><strong>Failure: </strong>Should verification fail, you will see:</span></li>
	</ul></li>
</ul><table><tbody><tr><td>
			<blockquote>
			<p><span>WARNING!!! FAILED TO VERIFY SIGNATURE OF Manifest.MoM</span></p>
			</blockquote>
			</td>
		</tr></tbody></table><p><span>7. As </span><span>swupd</span><span> then uses or installs bundle manifests, that bundle manifest hash is compared to the trusted MoM, extending the chain of trust from the MoM to the bundle manifests and out to every file installed.</span></p>

<h2> </h2>

<p> </p>
  </div>

<!-- END OUTPUT from 'modules/custom/clearlinux.org/themes/clearlinux_theme/templates/field/field--node--body.html.twig' -->



  </div>



<a class="back_to_top" href="security-software-update-clear-linux-os.html#">
  <i class="fa fa-angle-up"> </i>
</a>

<!-- END OUTPUT from 'modules/custom/clearlinux.org/themes/clearlinux_theme/templates/content/node--blog--full.html.twig' -->



<!-- END OUTPUT from 'modules/custom/clearlinux.org/themes/clearlinux_theme/templates/block/block--clearlinux-theme-content.html.twig' -->



<!-- END OUTPUT from 'modules/custom/clearlinux.org/themes/clearlinux_theme/templates/layout/region--content.html.twig' -->


  </main>

  <!-- /main -->


<footer class="footer">
  <div class="container padding-md--top-bottom padding-md--left-right">
    <div class="footer__logo">
      <div class="footer__logo__wrapper">
                  <img class="footer__site_img_object" src="../modules/custom/clearlinux.org/themes/clearlinux_theme/clear_linux_logo.svg" alt="Logo Clear Linux* Project"/>
                <img class="footer__site_txt_object" src="../modules/custom/clearlinux.org/themes/clearlinux_theme/sass/components/layout/footer/assets/clear-linux-text-white.svg" />
      </div>
    </div>
    <div class="footer__details">
              <div class="footer__top">
                      <div class="footer__social_media">
              <ul class="footer__social_media__list">
                                  <li class="footer__social_media__list_item">
                    <a target="_blank" tabindex='1' href="https://github.com/clearlinux" title="Github"><i class="fa "></i></a>
                  </li>
                                  <li class="footer__social_media__list_item">
                    <a target="_blank" tabindex='1' href="https://www.youtube.com/channel/UChpmukwyvvdSmTA9gxKL_Fg" title="YouTube"><i class="fa "></i></a>
                  </li>
                                  <li class="footer__social_media__list_item">
                    <a target="_blank" tabindex='1' href="http://twitter.com/clearlinux" title="Twitter"><i class="fa "></i></a>
                  </li>
                                  <li class="footer__social_media__list_item">
                    <a target="_blank" tabindex='1' href="https://community.clearlinux.org/" title="Discourse"><i class="fa "></i></a>
                  </li>
                              </ul>
            </div>
            <hr>
                                <div class="footer__menu">
              <ul class="footer__menu__list">
                                  <li class="footer__menu__list_item">
                    <a tabindex='1' href="http://www.intel.com/content/www/us/en/legal/trademarks.html">*Trademarks</a>
                  </li>
                                  <li class="footer__menu__list_item">
                    <a tabindex='1' href="http://www.intel.com/content/www/us/en/privacy/intel-cookie-notice.html">Cookies</a>
                  </li>
                                  <li class="footer__menu__list_item">
                    <a tabindex='1' href="https://www.intel.com/content/www/us/en/privacy/intel-privacy-notice.html">Privacy terms</a>
                  </li>
                              </ul>
            </div>
                  </div>
            <div class="footer__bottom">
        <p class="footer__copyright">© 2022  Intel Corporation. All Rights Reserved.<br>*Other names and brands may be claimed as the property of others.</p>
      </div>
    </div>
  </div>
  <div class="footer_bottom">
    <div class="container padding-md--left-right">
      <div class="footer_bottom__copyright">
        <i class="fa fa-copyright"></i>  &nbsp; This project belongs to 01.org, Intel's opensource platform.      </div>
    </div>
  </div>
</footer>

<!-- END OUTPUT from 'modules/custom/clearlinux.org/themes/clearlinux_theme/templates/layout/page.html.twig' -->


  </div>

<!-- END OUTPUT from 'core/themes/stable/templates/content/off-canvas-page-wrapper.html.twig' -->



<script src="../core/assets/vendor/jquery/jquery.min.js"></script>
<script src="../core/misc/polyfills/element.matches.js"></script>
<script src="../core/assets/vendor/once/once.min.js"></script>
<script src="../modules/contrib/extlink/extlink.js"></script>
<script src="../modules/contrib/google_analytics/js/google_analytics.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.2.1/owl.carousel.min.js" integrity="sha256-s5TTOyp+xlSmsDfr/aZhg0Gz+JejYr5iTJI8JxG1SkM=" crossorigin="anonymous"></script>
<script src="../modules/custom/clearlinux.org/themes/clearlinux_theme/js/src/jquery.colorbox.min.js"></script>
<script src="../modules/custom/clearlinux.org/themes/clearlinux_theme/js/src/clearlinux_theme.js"></script>
<script src="../modules/custom/clearlinux.org/themes/clearlinux_theme/bower_components/clipboard/dist/clipboard.min.js"></script>
<script src="../core/assets/vendor/js-cookie/js.cookie.min.js"></script>
<script src="../modules/contrib/eu_cookie_compliance/js/eu_cookie_compliance.min.js" defer></script>
<script src="../modules/custom/clearlinux.org/themes/clearlinux_theme/js/dist/layout/header/header.js"></script>
<script src="../libraries/codesnippet/lib/highlight/highlight.pack.js"></script>
<script src="../modules/contrib/codesnippet/js/codesnippet.js"></script>

</body>
</html>

<!-- END OUTPUT from 'modules/custom/clearlinux.org/themes/clearlinux_theme/templates/layout/html.html.twig' -->

